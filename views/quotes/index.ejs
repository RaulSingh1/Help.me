<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Quotes - Quote Collection</title>
    <%- include('../partials/styles') %>
</head>
<body>
    <header role="banner">
        <a href="/" class="logo" aria-label="Quote Collection Home">Quote Collection</a>
        <nav role="navigation" aria-label="Main navigation">
            <a href="/">Home</a>
            <a href="/quotes/search">search</a>
            <% if (typeof user !== 'undefined' && user) { %>
                <a href="/quotes/new">add quotes</a>
            <% } %>
        </nav>
        <div class="auth-links" role="navigation" aria-label="User menu">
            <% if (typeof user !== 'undefined' && user) { %>
                <span class="user-welcome" aria-live="polite">Welcome, <%= user.username %>!</span>
                <a href="/auth/logout">Logout</a>
            <% } else { %>
                <a href="/auth/login">Login</a>
                <a href="/auth/register">Register</a>
            <% } %>
        </div>
    </header>
    
    <main class="main-content wide" role="main">
        <h2 class="section-title">All Quotes</h2>
        
        <% if (typeof quotes !== 'undefined' && quotes.length > 0) { %>
            <div class="quotes-list" role="list" aria-label="Quote list">
                <% quotes.forEach(quote => { %>
                    <article class="quote-card" role="listitem">
                        <blockquote class="quote-text" aria-label="Quote text"><%= quote.text %></blockquote>
                        <div class="quote-meta">
                            <span><strong>Author:</strong> <%= quote.author %></span>
                            <span><strong>Category:</strong> <%= quote.category %></span>
                            <% if (quote.user) { %>
                                <span><strong>Added by:</strong> <%= quote.user.username %></span>
                            <% } %>
                        </div>
                        <div class="quote-actions">
                            <a href="/quotes/<%= quote._id %>" aria-label="View details of quote by <%= quote.author %>">View Details</a>
                            <% if (typeof user !== 'undefined' && user && quote.user && quote.user._id.toString() === user._id.toString()) { %>
                                <a href="/quotes/<%= quote._id %>/edit" aria-label="Edit this quote">Edit</a>
                                <form action="/quotes/<%= quote._id %>?_method=DELETE" method="POST" style="display:inline;">
                                    <button type="submit" onclick="return confirm('Are you sure?')" aria-label="Delete this quote">Delete</button>
                                </form>
                            <% } %>
                            <% if (typeof user !== 'undefined' && user) { %>
                                <% const isLiked = quote.likedBy && quote.likedBy.some(id => id.toString() === user._id.toString()); %>
                                <form action="/quotes/<%= quote._id %>/like" method="POST" style="display:inline;">
                                    <button type="submit" class="like-button <%= isLiked ? 'liked' : '' %>" aria-label="<%= isLiked ? 'Unlike' : 'Like' %>">
                                        <%= isLiked ? '♥' : '♡' %> <%= quote.likes || 0 %> Likes
                                    </button>
                                </form>
                            <% } %>
                        </div>
                    </article>
                <% }) %>
            </div>
        <% } else { %>
            <div class="empty-state" role="status">
                <h2>No Quotes Found</h2>
                <p>No quotes found yet.</p>
                <% if (typeof user !== 'undefined' && user) { %>
                    <p><a href="/quotes/new" class="btn">Add the first quote!</a></p>
                <% } else { %>
                    <p><a href="/auth/register">Register</a> or <a href="/auth/login">login</a> to add quotes.</p>
                <% } %>
            </div>
        <% } %>
    </main>
</body>
</html>

