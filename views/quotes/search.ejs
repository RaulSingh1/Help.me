<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Quotes - Quote Collection</title>
    <%- include('../partials/styles') %>
</head>
<body>
    <header>
        <a href="/" class="logo">Quote Collection</a>
        <nav>
            <a href="/">Home</a>
            <a href="/quotes/search">search</a>
            <% if (typeof user !== 'undefined' && user) { %>
                <a href="/quotes/new">add quotes</a>
            <% } %>
        </nav>
        <div class="auth-links">
            <% if (typeof user !== 'undefined' && user) { %>
                <span class="user-welcome">Welcome, <%= user.username %>!</span>
                <a href="/auth/logout">Logout</a>
            <% } else { %>
                <a href="/auth/login">Login</a>
                <a href="/auth/register">Register</a>
            <% } %>
        </div>
    </header>
    
    <main class="main-content wide">
        <h1>Search Quotes</h1>
        
        <div class="search-form">
            <form action="/quotes/search" method="GET">
                <label for="q">Search for quotes:</label>
                <div class="search-input-group">
                    <input type="text" id="q" name="q" placeholder="Enter search term..." value="<%= typeof query !== 'undefined' ? query : '' %>" required>
                    <button type="submit">Search</button>
                </div>
            </form>
        </div>
        
        <% if (quotes && quotes.length > 0) { %>
            <h2 class="section-title">Results for "<%= query %>"</h2>
            <div class="quotes-list">
                <% quotes.forEach(quote => { %>
                    <article class="quote-card">
                        <blockquote class="quote-text"><%= quote.text %></blockquote>
                        <div class="quote-meta">
                            <span><strong>Author:</strong> <%= quote.author %></span>
                            <span><strong>Category:</strong> <%= quote.category %></span>
                            <% if (quote.user) { %>
                                <span><strong>Added by:</strong> <%= quote.user.username %></span>
                            <% } %>
                        </div>
                        <div class="quote-actions">
                            <a href="/quotes/<%= quote._id %>">View Details</a>
                            <% if (typeof user !== 'undefined' && user && quote.user && quote.user._id.toString() === user._id.toString()) { %>
                                <a href="/quotes/<%= quote._id %>/edit">Edit</a>
                                <form action="/quotes/<%= quote._id %>?_method=DELETE" method="POST" style="display:inline;">
                                    <button type="submit" onclick="return confirm('Are you sure?')">Delete</button>
                                </form>
                            <% } %>
                            <% if (typeof user !== 'undefined' && user) { %>
                                <% const isLiked = quote.likedBy && quote.likedBy.some(id => id.toString() === user._id.toString()); %>
                                <form action="/quotes/<%= quote._id %>/like" method="POST" style="display:inline;">
                                    <button type="submit" class="like-button <%= isLiked ? 'liked' : '' %>">
                                        <%= isLiked ? '♥' : '♡' %> <%= quote.likes || 0 %> Likes
                                    </button>
                                </form>
                            <% } %>
                        </div>
                    </article>
                <% }) %>
            </div>
        <% } else if (typeof query !== 'undefined') { %>
            <div class="no-results">
                <p>No quotes found for "<%= query %>".</p>
                <p>Try different keywords or <a href="/quotes/search">clear the search</a>.</p>
            </div>
        <% } %>
    </main>
</body>
</html>

